<div class="preparation-container">
  <h2>Preparation</h2>

  <form [formGroup]="preparationForm" (ngSubmit)="onSubmit()">

    <label>Add parts of preparations:</label>

    <div formArrayName="steps">
      <div class="preparation-step" *ngFor="let step of steps.controls; let i = index" [formGroupName]="i">

        <div class="form-row inline-row">
          <div class="step-number">{{ i + 1 }}.</div>
          <div class="form-field">
            <label for="name{{i}}">Name:</label>
            <input id="name{{i}}" type="text" formControlName="name" />
          </div>
        </div>

        <div class="form-row">
        <div class="form-field">
            <label for="desc{{i}}">Description:</label>
            <textarea id="desc{{i}}" rows="3" formControlName="description"></textarea>
        </div>
        </div>

        <div *ngIf="step.errors?.['bothRequired'] && (step.touched || step.dirty)" class="validation-error">
          Both name and description are required if one is filled.
        </div>
      </div>
    </div>

    <button type="button" class="add-btn" (click)="addStep()">Add more...</button>

    <div *ngIf="preparationForm.errors?.['atLeastOne'] && (preparationForm.touched || preparationForm.dirty)" class="validation-error">
      At least one step with name and description is required.
    </div>

    <div class="button-row">
      <button type="submit" class="submit-btn" [disabled]="!preparationForm.valid">Update recipe</button>
      <button type="button" class="back-btn" (click)="goBack()">Back</button>
    </div>

  </form>
</div>
